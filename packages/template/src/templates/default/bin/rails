#!/usr/bin/env -S node --disable-warning=ExperimentalWarning

import { initVM, ExternalCommands, runRailsCommand } from "rails-wasm";
import path from "node:path";

const __dirname = path.dirname(new URL(import.meta.url).pathname);

const vm = await initVM({
  rubyWasmPath: path.join(__dirname, "../node_modules/@ruby/wasm-wasi/dist/ruby.wasm"),
  workspaceDir: path.join(__dirname, "../workspace"),
  pgDataDir: path.join(__dirname, "../pgdata"),
  env: { HOME: "/rails-vm" }
});

const commands = new ExternalCommands();
global.externalCommands = commands;

await runRailsCommand(vm, process.argv.slice(2));
commands.invoke(vm);
